= JWT Validation API Reference
:toc: left
:toclevels: 3
:source-highlighter: highlight.js

This document provides a comprehensive API reference for the JWT validation library.

== Core Classes

=== TokenValidator

The main entry point for token validation operations.

[source,java]
----
public class TokenValidator {
    // Builder pattern for configuration
    public static Builder builder() { ... }

    // Token creation methods (performs validation and returns validated token)
    // These methods throw TokenValidationException if validation fails
    public AccessTokenContent createAccessToken(String token);
    public IdTokenContent createIdToken(String token);
    public RefreshTokenContent createRefreshToken(String token);
----

=== AccessTokenContent

Represents a validated access token with its claims.

[source,java]
----
public class AccessTokenContent {
    // Standard claims
    public Optional<String> getSubject();     // Subject may be optional based on issuer config
    public String getIssuer();
    public Optional<List<String>> getAudience();
    public OffsetDateTime getExpirationTime();
    public OffsetDateTime getIssuedAtTime();

    // Access token specific
    public List<String> getRoles();
    public List<String> getGroups();
    public List<String> getScopes();          // Note: plural form
    public Optional<String> getEmail();
    public Optional<String> getPreferredUsername();

    // Authorization checks
    public boolean providesRoles(Collection<String> requiredRoles);
    public boolean providesGroups(Collection<String> requiredGroups);
    public boolean providesScopes(Collection<String> requiredScopes);
    public Set<String> determineMissingRoles(Collection<String> required);
    public Set<String> determineMissingGroups(Collection<String> required);
    public Set<String> determineMissingScopes(Collection<String> required);
}
----

=== IssuerConfig

Configuration for a specific token issuer.

[source,java]
----
public class IssuerConfig {
    public static Builder builder() { ... }

    public static class Builder {
        // Issuer identification
        public Builder issuerIdentifier(String issuer);

        // Key configuration
        public Builder signatureKey(String key);
        public Builder jwksContent(String jwks);
        public Builder jwksUri(String uri);
        public Builder httpJwksLoaderConfig(HttpJwksLoaderConfig config);

        // Validation configuration
        public Builder expectedAudience(String... audience);
        public Builder expectedClientId(String clientId);
        public Builder clockSkew(Duration skew);

        // Claim mapping
        public Builder claimMapper(String claim, ClaimMapper mapper);
        public Builder rolesPath(String path);
        public Builder groupsPath(String path);

        public IssuerConfig build();
    }
}
----

== Configuration Classes

=== ParserConfig

Security configuration for token parsing.

[source,java]
----
public class ParserConfig {
    public static Builder builder() { ... }

    public static class Builder {
        public Builder maxTokenSize(int bytes);      // Default: 8192
        public Builder maxPayloadSize(int bytes);    // Default: 2048
        public Builder maxStringSize(int bytes);     // Default: 1024
        public Builder maxArraySize(int elements);   // Default: 64
        public Builder maxDepth(int levels);         // Default: 10

        public ParserConfig build();
    }
}
----

=== AccessTokenCacheConfig

Configuration for access token caching.

[source,java]
----
public class AccessTokenCacheConfig {
    public static Builder builder() { ... }

    public static class Builder {
        public Builder maxSize(long entries);        // Default: 1000
        public Builder ttlSeconds(long seconds);     // Default: 300
        public Builder enabled(boolean enabled);     // Default: true

        public AccessTokenCacheConfig build();
    }
}
----

=== HttpJwksLoaderConfig

Configuration for JWKS endpoint loading.

[source,java]
----
public class HttpJwksLoaderConfig {
    public static Builder builder() { ... }

    public static class Builder {
        public Builder jwksUri(String uri);
        public Builder wellKnown(HttpWellKnownResolver resolver);
        public Builder connectTimeoutSeconds(int seconds);
        public Builder readTimeoutSeconds(int seconds);
        public Builder refreshIntervalSeconds(int seconds);
        public Builder sslContext(SSLContext context);

        public HttpJwksLoaderConfig build();
    }
}
----

== Claim Mappers

=== JsonCollectionMapper

Maps JSON arrays and strings to collections.

[source,java]
----
public class JsonCollectionMapper implements ClaimMapper {
    // Automatically handles:
    // - JSON arrays: ["admin", "user"]
    // - Single strings: "admin"
    // - Mixed types: ["admin", 123, true]
}
----

=== StringSplitterMapper

Splits delimited strings into collections.

[source,java]
----
public class StringSplitterMapper implements ClaimMapper {
    public StringSplitterMapper(char separator);

    // Splits strings like:
    // "admin,user,manager" with ',' separator
    // "admin:user:manager" with ':' separator
}
----

=== Custom ClaimMapper

Interface for implementing custom claim mapping logic.

[source,java]
----
public interface ClaimMapper {
    List<String> mapClaim(Object claimValue);
}
----

== Error Handling

The library uses exceptions to indicate validation failures rather than result objects.

=== TokenValidationException

Main exception for validation failures.

[source,java]
----
public class TokenValidationException extends Exception {
    public String getMessage();
    // Contains detailed error information
}
----

== Security Configuration

=== Security Layers

The library implements multiple security layers:

[cols="1,3,1,3"]
|===
|Setting |Purpose |Default |Applied When

|`maxTokenSize`
|Limits entire JWT token string
|8KB
|Before any processing

|`maxPayloadSize`
|Limits each decoded JWT part
|2KB
|After Base64 decoding

|`maxStringSize`
|Limits individual JSON string values
|1KB
|During JSON parsing

|`maxArraySize`
|Limits JSON array size
|64
|During JSON parsing

|`maxDepth`
|Limits JSON nesting depth
|10
|During JSON parsing
|===

=== Size Relationships

Base64 encoding increases size by ~33%, so:

* 8KB token â†’ ~6KB decoded content
* 2KB per part limit accommodates header + payload
* 1KB string limit prevents individual field attacks

These limits provide defense-in-depth against:

* Denial-of-service attacks
* Memory exhaustion
* JSON parsing vulnerabilities

=== WellKnownDiscoveryException  

Exception for OpenID Connect discovery failures.

[source,java]
----
public class WellKnownDiscoveryException extends Exception {
    // Network errors, malformed responses, missing fields
}
----

For usage examples, see xref:usage-guide.adoc[Usage Guide].